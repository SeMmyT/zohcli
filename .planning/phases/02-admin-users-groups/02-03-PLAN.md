---
phase: 02-admin-users-groups
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - internal/zoho/admin_client.go
  - internal/cli/admin_groups.go
  - internal/cli/cli.go
autonomous: true

must_haves:
  truths:
    - "User can run `zoh admin groups list` and see all organization groups"
    - "User can run `zoh admin groups get <id-or-email>` and see group details with members"
    - "User can run `zoh admin groups create` to create a new group"
    - "User can run `zoh admin groups update` to change group name or description"
    - "User can run `zoh admin groups delete` to remove a group (with --confirm)"
    - "User can run `zoh admin groups members add/remove` to manage group membership"
  artifacts:
    - path: "internal/zoho/admin_client.go"
      provides: "Group CRUD and member management methods on AdminClient"
      contains: "func (ac *AdminClient) ListGroups"
    - path: "internal/cli/admin_groups.go"
      provides: "CLI commands for group list, get, create, update, delete, member add/remove"
      contains: "type AdminGroupsListCmd struct"
  key_links:
    - from: "internal/cli/admin_groups.go"
      to: "internal/zoho/admin_client.go"
      via: "AdminClient group methods"
      pattern: "ac\\.ListGroups|ac\\.CreateGroup|ac\\.AddGroupMembers"
    - from: "internal/zoho/admin_client.go"
      to: "internal/zoho/types.go"
      via: "Uses Group, CreateGroupRequest, AddGroupMembersRequest types"
      pattern: "GroupListResponse|CreateGroupRequest|AddGroupMembersRequest"
---

<objective>
Implement all group management commands: list, get, create, update, delete, and member add/remove, completing the full admin story.

Purpose: Delivers group management entirely from the terminal, covering ADMIN-GRP-01 through ADMIN-GRP-06. This plan runs in parallel with 02-02 (user mutations) since they share no files except admin_client.go (additive methods only) and cli.go (additive struct fields only).
Output: Working `zoh admin groups list/get/create/update/delete` and `zoh admin groups members add/remove` commands.
</objective>

<execution_context>
@/home/semmy/.claude/get-shit-done/workflows/execute-plan.md
@/home/semmy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-admin-users-groups/02-RESEARCH.md
@.planning/phases/02-admin-users-groups/02-01-SUMMARY.md
@internal/zoho/admin_client.go
@internal/zoho/types.go
@internal/cli/cli.go
@internal/output/formatter.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: AdminClient group CRUD and member management methods</name>
  <files>internal/zoho/admin_client.go</files>
  <action>
Add the following methods to AdminClient in admin_client.go:

**ListGroups(ctx, start, limit int) ([]Group, error)**
- GET /api/organization/{zoid}/groups?start={start}&limit={limit}
- Decode GroupListResponse, return Data slice
- Used by PageIterator for pagination

**GetGroup(ctx, zgid int64) (*Group, error)**
- GET /api/organization/{zoid}/groups/{zgid}
- Decode GroupDetailResponse, return &Data
- Should include member details if API returns them

**GetGroupMembers(ctx, zgid int64) ([]GroupMember, error)**
- GET /api/organization/{zoid}/groups/{zgid}/members
- Decode response into []GroupMember
- Returns full member list for the group

**GetGroupByEmail(ctx, email string) (*Group, error)**
- Iterate group pages via ListGroups until GroupEmailAddress matches email
- Return error if not found (same pattern as GetUserByEmail)

**CreateGroup(ctx, req CreateGroupRequest) (*Group, error)**
- POST /api/organization/{zoid}/groups
- Marshal CreateGroupRequest as JSON body
- Expect HTTP 201 Created
- Decode GroupDetailResponse, return &Data

**UpdateGroup(ctx, zgid int64, name, description string) error**
- PUT /api/organization/{zoid}/groups/{zgid}
- Body: `{"mode": "updateMailGroup", "groupName": "...", "description": "..."}`
- Only include non-empty fields in request body
- Expect HTTP 200

**DeleteGroup(ctx, zgid int64) error**
- DELETE /api/organization/{zoid}/groups/{zgid}
- No request body
- Expect HTTP 200

**AddGroupMembers(ctx, zgid int64, members []GroupMemberToAdd) error**
- PUT /api/organization/{zoid}/groups/{zgid}
- Body: AddGroupMembersRequest with Mode="addMailGroupMember", MailGroupMemberList=members
- Batch in groups of 50 if len(members) > 50 (safety margin for API limits)
- Expect HTTP 200

**RemoveGroupMembers(ctx, zgid int64, members []GroupMemberToRemove) error**
- PUT /api/organization/{zoid}/groups/{zgid}
- Body: RemoveGroupMembersRequest with Mode="removeMailGroupMember", MailGroupMemberList=members
- Expect HTTP 200

Also add `GroupMembersResponse` to types.go if needed: Status + Data []GroupMember.

Ensure `go build ./internal/zoho/...` compiles.
  </action>
  <verify>
Run `go build ./internal/zoho/...` — compiles.
Run `go vet ./internal/zoho/...` — no warnings.
  </verify>
  <done>
AdminClient has all group methods: ListGroups, GetGroup, GetGroupMembers, GetGroupByEmail, CreateGroup, UpdateGroup, DeleteGroup, AddGroupMembers, RemoveGroupMembers. All use correct endpoints, HTTP methods, and mode parameters.
  </done>
</task>

<task type="auto">
  <name>Task 2: Group CLI commands with member management</name>
  <files>internal/cli/admin_groups.go, internal/cli/cli.go</files>
  <action>
Create internal/cli/admin_groups.go with:

**AdminGroupsListCmd:**
- Limit int `help:"Maximum groups to show per page" short:"l" default:"50"`
- All bool `help:"Fetch all groups" short:"a"`
- Run: create AdminClient (reuse newAdminClient helper from admin_users.go — if it's not exported, make a shared helper or duplicate the 3-line pattern), list groups, output via PrintList
- Columns: Name (GroupName), Email (GroupEmailAddress), Members (MembersCount), ZGID

**AdminGroupsGetCmd:**
- Identifier string `arg:"" help:"Group ID (zgid) or group email address"`
- ShowMembers bool `help:"Include member list" short:"m" default:"true"`
- Run: resolve identifier (@ means email -> GetGroupByEmail, else parse int64 -> GetGroup). Print group details via fp.Formatter.Print. If ShowMembers, also fetch and print members via fp.Formatter.PrintList with columns: Email (MemberEmailID), Role, ZUID.

**AdminGroupsCreateCmd:**
- Name string `arg:"" help:"Group display name"`
- Email string `help:"Group email address" required:"" short:"e"`
- Description string `help:"Group description" short:"d"`
- Run: build CreateGroupRequest, call ac.CreateGroup, output created group, print confirmation to stderr

**AdminGroupsUpdateCmd:**
- Identifier string `arg:"" help:"Group ID (zgid) or group email address"`
- Name string `help:"New group name" short:"n"`
- Description string `help:"New description" short:"d"`
- Run: resolve identifier to zgid, call ac.UpdateGroup with non-empty fields, print confirmation to stderr
- Require at least one of --name or --description (error if both empty)

**AdminGroupsDeleteCmd:**
- Identifier string `arg:"" help:"Group ID (zgid) or group email address"`
- Confirm bool `help:"Confirm permanent deletion (required)" required:""`
- Run: resolve identifier to zgid, require --confirm, call ac.DeleteGroup, print confirmation to stderr

**AdminGroupsMembersAddCmd:**
- Group string `arg:"" help:"Group ID (zgid) or group email address"`
- Members []string `arg:"" help:"Email addresses of members to add"`
- Role string `help:"Member role: member, moderator" default:"member" enum:"member,moderator" short:"r"`
- Run: resolve group identifier to zgid, build []GroupMemberToAdd from Members with Role, call ac.AddGroupMembers
- On success: print count of members added to stderr

**AdminGroupsMembersRemoveCmd:**
- Group string `arg:"" help:"Group ID (zgid) or group email address"`
- Members []string `arg:"" help:"Email addresses of members to remove"`
- Run: resolve group identifier to zgid, build []GroupMemberToRemove from Members, call ac.RemoveGroupMembers
- On success: print count of members removed to stderr

Helper function `resolveGroupID(ac *zoho.AdminClient, identifier string) (int64, error)`:
- If identifier contains "@": call ac.GetGroupByEmail, return group.ZGID
- Else: parse as int64, return directly

Update cli.go to register group commands:
```go
type AdminCmd struct {
    Users  AdminUsersCmd  `cmd:"" help:"Manage organization users"`
    Groups AdminGroupsCmd `cmd:"" help:"Manage organization groups"`
}

type AdminGroupsCmd struct {
    List    AdminGroupsListCmd    `cmd:"" help:"List organization groups"`
    Get     AdminGroupsGetCmd     `cmd:"" help:"Get group details"`
    Create  AdminGroupsCreateCmd  `cmd:"" help:"Create a new group"`
    Update  AdminGroupsUpdateCmd  `cmd:"" help:"Update group settings"`
    Delete  AdminGroupsDeleteCmd  `cmd:"" help:"Delete a group permanently"`
    Members AdminGroupsMembersCmd `cmd:"" help:"Manage group members"`
}

type AdminGroupsMembersCmd struct {
    Add    AdminGroupsMembersAddCmd    `cmd:"" help:"Add members to a group"`
    Remove AdminGroupsMembersRemoveCmd `cmd:"" help:"Remove members from a group"`
}
```

NOTE: If 02-02 has already run and modified cli.go to add AdminUsersCmd subcommands, merge carefully. If 02-02 has NOT run yet (this is Wave 2 parallel), add the Groups field to AdminCmd alongside the existing Users field. The AdminCmd struct should have both Users and Groups.

Error handling: same pattern as user commands — ExitAuth, ExitAPIError, ExitUsage, ExitGeneral.
  </action>
  <verify>
Run `go build ./...` — full project compiles.
Run `go vet ./...` — no warnings.
Run `./zoh admin groups --help` — shows list, get, create, update, delete, members subcommands.
Run `./zoh admin groups members --help` — shows add, remove subcommands.
Run `./zoh admin groups create --help` — shows name arg, --email required flag.
Run `./zoh admin groups members add --help` — shows group arg, members arg, --role flag.
  </verify>
  <done>
All group commands registered and compile. List shows groups with pagination, get shows details with members, create/update/delete manage group lifecycle, members add/remove manage membership. All commands support email-or-ID resolution and output in all three modes.
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` — entire project compiles
2. `go vet ./...` — no warnings
3. `./zoh admin groups --help` — shows all subcommands
4. `./zoh admin groups list --help` — shows --limit, --all flags
5. `./zoh admin groups get --help` — shows --show-members flag
6. `./zoh admin groups create --help` — shows name arg, --email required
7. `./zoh admin groups update --help` — shows --name, --description flags
8. `./zoh admin groups delete --help` — shows --confirm required
9. `./zoh admin groups members add --help` — shows group arg, members, --role
10. `./zoh admin groups members remove --help` — shows group arg, members
</verification>

<success_criteria>
- AdminClient has all group methods (ListGroups, GetGroup, GetGroupMembers, GetGroupByEmail, CreateGroup, UpdateGroup, DeleteGroup, AddGroupMembers, RemoveGroupMembers)
- Group list shows paginated groups with Name, Email, Members count, ZGID
- Group get shows full details including member list (optional via flag)
- Group create accepts name (arg) + email (required flag) + optional description
- Group update allows changing name and/or description
- Group delete requires --confirm flag
- Member add supports multiple emails in one command with role specification
- Member remove supports multiple emails in one command
- Member batch size capped at 50 per API call (batched automatically)
- All output modes (JSON, plain, rich) work correctly for all commands
</success_criteria>

<output>
After completion, create `.planning/phases/02-admin-users-groups/02-03-SUMMARY.md`
</output>
